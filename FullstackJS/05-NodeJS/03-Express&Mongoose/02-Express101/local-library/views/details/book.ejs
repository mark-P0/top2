<!doctype html>
<html lang="en">
  <head>
    <%- include('../components/head.ejs') -%>

    <title><%= title -%> | Local Library</title>
  </head>
  <body class="grid md:grid-cols-[1fr_4fr] gap-6 p-6">
    <aside><%- include('../components/nav-links.ejs') -%></aside>

    <main class="grid auto-rows-min gap-6">
      <header class="flex justify-between gap-12">
        <h1 class="text-5xl"><%= title -%></h1>
        <nav class="flex gap-3">
          <% if (!showDeleteButton) { -%>
          <%- include('../components/link.ejs', {href: `./${id}/update`, text: 'Update'}) -%>
          <%- include('../components/link.ejs', {href: `./${id}/delete`, text: 'Delete'}) -%>
          <% } -%>
        </nav>
      </header>

      <ul class="grid gap-1">
        <li>
          <strong>Author:</strong>
          <%- include('../components/link.ejs', {href: author.url, text: author.name}) -%>
        </li>
        <li>
          <strong>Summary:</strong>
          <%= summary -%>
        </li>
        <li>
          <strong>ISBN:</strong>
          <%= isbn -%>
        </li>
        <% if (genre.length > 0) { -%>
        <li>
          <% if (genre.length === 1) { -%>
          <strong>Genre:</strong>
          <% } else if (genre.length > 1) { -%>
          <strong>Genres:</strong>
          <% } -%>

          <ul class="inline-flex">
            <% genre.forEach(({url, name}) => { -%>
            <li
              class="flex [&:not(:last-child)]:after:content-[',_'] after:whitespace-pre"
            >
              <%- include('../components/link.ejs', {href: url, text: name}) -%>
            </li>
            <% }) -%>
          </ul>
        </li>
        <% } -%>
      </ul>

      <%- include('../components/errors.ejs', {errors}) -%>

      <% if (copies.length > 0) { -%>
      <section class="grid gap-3">
        <h2 class="text-4xl">Copies</h2>
        <ul class="grid gap-3">
          <%# prettier-ignore -%>
          <% copies.forEach(({status, imprint, url, due_back_formatted}, idx) => { -%>
          <% const ct = idx + 1 -%>

          <li>
            <a href="<%= url -%>">
              <ul class="border-2 hover:bg-gray-100 transition px-3 py-2">
                <li>
                  #<%= ct -%>:
                  <%- include('../components/availability-label.ejs', {status}) -%>
                </li>
                <li>
                  <strong>Imprint:</strong>
                  <%= imprint -%>
                </li>
                <% if (status !== 'Available') { -%>
                <li>
                  <strong>Due back:</strong>
                  <%= due_back_formatted -%>
                </li>
                <% } -%>
              </ul>
            </a>
          </li>
          <% }) -%>
        </ul>
      </section>
      <% } -%>

      <% if (copies.length === 0 && !showDeleteButton) { -%>
      <section class="grid gap-3">
        <h2 class="text-4xl">Copies</h2>
        <p>There are no copies of this book in the library.</p>
      </section>
      <% } -%>

      <% if (copies.length === 0 && showDeleteButton) { -%>
      <form method="post" class="grid justify-items-start gap-3">
        Are you sure you want to delete this book?

        <button type="submit" class="rounded bg-red-600 text-white px-5 py-2">
          Yes, delete this book.
        </button>
      </form>
      <% } -%>
    </main>
  </body>
</html>
